plugin: "netcho.opennebula.opennebula"
one_hostname_preference: name
strict: true
use_extra_vars: true
compose:
  ansible_host: name + "." + (network_id_domain_map | dict2items(key_name="network_id", value_name"domain_name") | first)["domain_name"] if network_id_domain_map | length else (nic | selectattr("ip", "defined") | first)["ip"]
  running: state == "active" and lcm_state == "running"
  services: dict(user_attributes.services | split(",") | map("split", ":")) if user_attributes.services is defined else {}
groups:
  moonstone_monitor: 'user_attributes.labels is defined and "Production" in user_attributes.labels'
  moonstone_monitor_deploy: 'user_attributes.labels is defined and "Production" in user_attributes.labels and "no_monitor_deploy" not in user_attributes.labels'
