plugin: "netcho.opennebula.opennebula"
one_hostname_preference: name
strict: true
use_extra_vars: true
compose:
  ansible_host: nic | selectattr("ip", "defined") | map (attribute="ip") | first if nic | selectattr("ip", "defined") | length else name
  running: state == 'active' and lcm_state == 'running'
  services: user_attributes.services | split(",") | map("split", ":") if user_attributes.services is defined else dict()
groups:
  moonstone_monitor: 'user_attributes.labels is defined and "Production" in user_attributes.labels'
  moonstone_monitor_deploy: 'user_attributes.labels is defined and "Production" in user_attributes.labels and "no_monitor_deploy" not in user_attributes.labels'
