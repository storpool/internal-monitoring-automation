- name: Debbugging presence of firewalld
  debug:
    msg: "Firewalld present: {{ 'firewalld' in ansible_facts.services }} and state: {{ ansible_facts.services['firewalld'].state if 'firewalld' in ansible_facts.services }}"

- name: Enable node exporter port on firewalld
  ansible.posix.firewalld:
    port: "{{ node_exporter_web_listen_port }}/tcp"
    state: enabled
    permanent: true
    immediate: true
  when:
    - "'firewalld' in ansible_facts.services"
    - "ansible_facts.services['firewalld'].state == 'running'"